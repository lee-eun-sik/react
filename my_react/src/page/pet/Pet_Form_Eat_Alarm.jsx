import React, { useState, useRef, useEffect } from "react";
import {
  Box,
  Button,
  Typography,
  TextField,
  Switch,
  Grid,
  Avatar,
} from "@mui/material";
import IconButton from "@mui/material/IconButton";

import { LocalizationProvider, TimePicker } from "@mui/x-date-pickers";
import { DatePicker } from "@mui/x-date-pickers/DatePicker";
import { AdapterDayjs } from "@mui/x-date-pickers/AdapterDayjs";
import dayjs from "dayjs";
import { CmUtil } from "../../cm/CmUtil";

import { useCmDialog } from "../../cm/CmDialogUtil";
import { Tabs, Tab } from "@mui/material";
import Combo from "../combo/combo";
import { useLocation, useNavigate, useSearchParams } from "react-router-dom";
import { useGetPetByIdQuery } from "../../features/pet/petApi";
import {
  useAlarmCreateMutation,
  useAlarmListQuery,
  useAlarmUpdateMutation,
  useAlarmDeleteMutation,
} from "../../features/alarm/alarmApi";
import AlarmMinus from "../../image/alarmMinus.png";
import DefaultImage from "../../image/dafault-animal.png";

const RepottingContent = ({
  setEatType,
  eatType,
  alarmName,
  setAlarmName,
  setAlarmCycle,
  alarmCycle,
  alarmTime,
  setAlarmTime,
  alarmDate,
  setAlarmDate,
  alarmCreate,
  alarmList,
  toggleAlarm,
  alarmDelete,
}) => {
  return (
    <>
      {/* ÏïåÎ¶º ÏÑ§Ï†ï ÏòÅÏó≠ */}
      <Box>
        <Box
          sx={{
            display: "flex",
            alignItems: "center",
            marginBottom: 1.5,
            justifyContent: "space-between",
          }}
        >
          <Typography sx={{ fontWeight: "700", marginTop: -5, marginRight: 2 }}>
            Î®πÏù¥ ÏïåÎ¶ºÏÑ§Ï†ï üîî
          </Typography>
          <Combo
            groupId="EatType"
            onSelectionChange={setEatType}
            defaultValue={eatType}
            sx={{
              fontSize: 14,
              width: "150px",
              height: "37px",
              backgroundColor: "#F8F8F8",
              borderRadius: "8px",
              marginLeft: 10,
            }}
          />
        </Box>

        <Box
          sx={{
            display: "flex",
            justifyContent: "space-between",
            alignItems: "center",
            marginBottom: 1.5,
          }}
        >
          <Typography className="light-status-title">Î®πÏù¥Ïù¥Î¶Ñ</Typography>
          <TextField
            className="sunlight-status-textfield"
            multiline
            rows={1.2}
            value={alarmName}
            onChange={(e) => setAlarmName(e.target.value)}
            variant="outlined"
            sx={{
              width: "273px",
              "& .MuiOutlinedInput-root": {
                backgroundColor: "#F8F8F8",
                borderRadius: "8px",
                padding: "0px", // ÎÇ¥Î∂Ä Ìå®Îî© Ï†úÍ±∞
              },
              "& .MuiInputBase-input": {
                padding: "6px 8px", // ÌÖçÏä§Ìä∏ ÏûÖÎ†• Í≥µÍ∞ÑÏùò Ìå®Îî© Ï°∞Ï†à
                fontSize: "14px", // Ìè∞Ìä∏ ÏÇ¨Ïù¥Ï¶à Ï§ÑÏù¥Î©¥ ÎÜíÏù¥ÎèÑ Ï§ÑÏñ¥Îì¶
              },
            }}
          />
        </Box>

        <Box
          sx={{
            display: "flex",
            justifyContent: "space-between",
            alignItems: "center",
            marginLeft: 10,
          }}
        >
          <Box>
            <Typography className="light-status-title">Ï£ºÍ∏∞</Typography>
            <Combo
              groupId="AlarmCycle"
              onSelectionChange={setAlarmCycle}
              defaultValue={alarmCycle}
              sx={{
                fontSize: 14,
                width: "120px",
                height: "35px",
                backgroundColor: "#F8F8F8",
                borderRadius: "8px",
                mt: -2.0,
              }}
            />
          </Box>

          <Box>
            <Typography className="light-status-title">ÏãúÍ∞Å</Typography>
            <Box>
              <LocalizationProvider
                dateAdapter={AdapterDayjs}
                adapterLocale="ko"
              >
                <TimePicker
                  ampm
                  value={alarmTime}
                  onChange={(newValue) => {
                    setAlarmTime(newValue);
                  }}
                  slotProps={{
                    textField: {
                      size: "small",
                      InputProps: {
                        sx: {
                          fontSize: 14,
                          borderRadius: "8px",
                          backgroundColor: "#F8F8F8",
                          width: "130px",
                          pl: "15px",
                        },
                      },
                    },
                  }}
                />
              </LocalizationProvider>
            </Box>
          </Box>
        </Box>

        <Box
          sx={{
            display: "flex",
            justifyContent: "space-between",
            alignItems: "center",
            gap: 3,
            marginBottom: 1.3,
          }}
        >
          <Box
            sx={{
              mt: 1,
            }}
          >
            <Typography className="light-status-title">ÏïåÎ¶ºÎÇ†Ïßú</Typography>
          </Box>
          <Box sx={{ marginTop: "10px" }}>
            <LocalizationProvider dateAdapter={AdapterDayjs} adapterLocale="ko">
              <DatePicker
                format="YYYY.MM.DD"
                value={alarmDate}
                onChange={(newValue) => {
                  setAlarmDate(newValue);
                }}
                renderInput={(params) => (
                  <TextField size="small" {...params} fullWidth />
                )}
                slotProps={{
                  textField: {
                    size: "small",
                    InputProps: {
                      sx: {
                        fontSize: 14,
                        borderRadius: "8px",
                        backgroundColor: "#F8F8F8",
                        width: "271px",
                        pl: "28px",
                      },
                    },
                  },
                }}
              />
            </LocalizationProvider>
          </Box>
        </Box>

        <Button
          variant="contained"
          className="save-button"
          onClick={alarmCreate}
          sx={{
            backgroundColor: "#4B6044 !important", // Ï†ÄÏû•
            "&:hover": {
              backgroundColor: "#88AE97 !important",
            },
          }}
        >
          ÏïåÎ¶ºÎì±Î°ù
        </Button>

        <Box
          sx={{
            width: "320px",
            mt: 2,
            border: "1px solid #ccc",
            borderRadius: "10px",
            p: 2,
            boxShadow: "0 0 4px rgba(0,0,0,0.1)",
          }}
        >
          <Typography
            variant="h6"
            align="center"
            sx={{
              fontWeight: "bold",
              borderBottom: "1px solid #ccc",
              paddingBottom: 1.7,
            }}
          >
            ÏïåÎ¶º Î™©Î°ù
          </Typography>

          {alarmList.map((alarm, idx) => (
            <Grid
              item
              xs={12}
              key={idx}
              container
              alignItems="center"
              sx={{
                py: 1,
                width: "100%",
                display: "flex",
                justifyContent: "space-between",
                borderBottom: "1px solid #ccc",
              }}
            >
              {/* ÏïåÎûå Ïù¥Î¶Ñ */}
              <Grid item xs={5}>
                <Typography
                  sx={{
                    fontSize: 14,
                    width: 50,
                  }}
                >
                  {alarm.alarmName}
                </Typography>
              </Grid>
              <Grid item xs={1}>
                <Typography
                  sx={{
                    fontSize: 12,
                    color: "#777",
                    width: 30,
                  }}
                >
                  {alarm.type}
                </Typography>
              </Grid>

              {/* Ï£ºÍ∏∞ */}
              <Grid item xs={1}>
                <Typography
                  sx={{
                    fontSize: 13,
                  }}
                >
                  {alarm.alarmCycle}Ïùº
                </Typography>
              </Grid>

              <Grid item xs={2}>
                <Typography
                  sx={{
                    fontSize: 13,
                  }}
                >
                  {`${alarm.hour}:${alarm.min.toString().padStart(2, "0")}`}
                </Typography>
              </Grid>

              {/* Ïä§ÏúÑÏπò */}
              <Grid item xs={2}>
                <Switch
                  checked={alarm.enabled}
                  onChange={() => toggleAlarm(alarm.alarmId)}
                  color="default"
                  size="small"
                  sx={{
                    width: 45,
                    height: 30,
                    padding: 0,
                    "& .MuiSwitch-switchBase": {
                      padding: "2px",
                      "&.Mui-checked": {
                        transform: "translateX(16px)",
                        color: "#fff",
                        "& + .MuiSwitch-track": {
                          backgroundColor: "#90caf9",
                          opacity: 1,
                        },
                      },
                    },
                    "& .MuiSwitch-thumb": {
                      //Ïä§ÏúÑÏπò ÎèôÍ∑∏ÎùºÎØ∏ ÌÅ¨Í∏∞ Ï°∞Ï†à
                      width: 25,
                      height: 25,
                      boxShadow: "0 0 2px rgba(0, 0, 0, 0.2)",
                    },
                    "& .MuiSwitch-track": {
                      borderRadius: 10,
                      backgroundColor: "#e0e0e0",
                      opacity: 1,
                    },
                  }}
                />
              </Grid>

              {/* ÏÇ≠Ï†ú Î≤ÑÌäº */}
              <Grid item xs={1}>
                <IconButton
                  onClick={() => alarmDelete(alarm.alarmId)}
                  size="small"
                  sx={{ p: 0 }}
                >
                  <img
                    src={AlarmMinus}
                    alt="ÏïåÎûå ÏÇ≠Ï†ú"
                    style={{ width: 24, height: 24 }}
                  />
                </IconButton>
              </Grid>
            </Grid>
          ))}
        </Box>
      </Box>
    </>
  );
};

const Pet_Form_Eat_Alarm = () => {
  const navigate = useNavigate();
  const location = useLocation();

  const pathToTabIndex = {
    "/pet/petFormHospital.do": 0,
    "/pet/petFormEatAlarm.do": 1,
    "/pet/petFormTrainingAndAction.do": 2,
  };

  const [AlarmCreate] = useAlarmCreateMutation({});
  const [alarmUpdate] = useAlarmUpdateMutation();
  const [alarmDel] = useAlarmDeleteMutation();

  const [selectedTab, setSelectedTab] = useState(0);
  const [searchParams] = useSearchParams();
  const animalId = searchParams.get("animalId"); // ÎèôÎ¨ºÏïÑÏù¥Îîî animalId parmÏóê Ï†ÄÏû•
  const [alarmName, setAlarmName] = useState("");
  const newFormattedTimes = [];
  const [alarmDate, setAlarmDate] = useState(dayjs());
  const [alarmTime, setAlarmTime] = useState(dayjs().hour(9).minute(0));
  const [alarmList, setAlarmList] = useState([]);
  const [isActive, setIsActive] = useState("");
  const { showAlert } = useCmDialog();
  const { showConfirm } = useCmDialog(); 
  const [animalName, setAnimalName] = useState("");
  const [animalAdoptionDate, setAnimalAdoptionDate] = useState(dayjs());
  const { data: petInfo, isLoading: isPetLoading } = useGetPetByIdQuery(
    animalId,
    {
      skip: !animalId,
    }
  ); // Í∑∏ ÎèôÎ¨ºÏïÑÏù¥ÎîîÏùò Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ ( Ìó§Îçî ÏÇΩÏûÖÌï† Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå )
  const [imageFile, setImageFile] = useState(null);
  const [existingImageUrl, setExistingImageUrl] = useState("");
  const [fileUrl, setFileUrl] = useState();

  const alarmTimeRef = useRef();
  const alarmNameRef = useRef();
  const alarmDateRef = useRef();
  const [eatType, setEatType] = useState(""); // ÏÑ†ÌÉùÎêú Î®πÏù¥
  const [alarmCycle, setAlarmCycle] = useState(""); // ÏÑ†ÌÉùÎêú Ï£ºÍ∏∞
  const {
    data: dbAlarmList,
    error,
    isLoading,
    refetch,
  } = useAlarmListQuery({
    petId: animalId, // plantId ÏïÑÏù¥ÎîîÏ°∞Ìöå  Î∞±Îã®ÏóêÏÑú Ïù¥ ÏïÑÏù¥ÎîîÎ°úÎßåÎì† ÏïåÎûåÏûàÏúºÎ©¥ update, ÏóÜÏúºÎ©¥ insert
    category: "ANI",
  });

  useEffect(() => {
    alarmSet();
  }, []);

  const alarmSet = async () => {
    // ÏïåÎûåÏïÑÏù¥ÎîîÏóÜÏúºÎ©¥ catch Î°úÍ∞ê
    try {
      const response = await refetch();
      console.log("aaaaaaa", response);
      console.log("response.data:", response.data);
      console.log(
        "response.data.success:",
        response.data.success,
        typeof response.data.success
      );
      console.log(
        "response.data.data:",
        response.data.data,
        Array.isArray(response.data.data)
      );

      if (
        response.data &&
        Array.isArray(response.data?.data) &&
        response.data.success
      ) {
        console.log("Ï†ÑÏ≤¥ ÏïåÎûå Î¶¨Ïä§Ìä∏:", response.data.data);

        const alarms = response.data.data.map((alarm) => {
          const alarmId = parseInt(alarm.alarmId, 10);
          const petId = parseInt(alarm.petId, 10);
          const alarmName = alarm.alarmName;
          const year = 2000 + parseInt(alarm.year, 10);
          const month = alarm.month;
          const day = parseInt(alarm.day, 10);
          const hour = parseInt(alarm.hour, 10);
          const min = parseInt(alarm.min, 10);
          const daysDate = dayjs(alarm.startDate); // Î∂àÎü¨Ïò® ÏÑ∏ÌåÖÎÇ†Ïßú dayjs Î°ú
          const daysTime = dayjs(alarm.alarmTime, "HH:mm"); // Î∂àÎü¨Ïò® ÏÑ∏ÌåÖÏãúÍ∞Ñ dayjs Î°ú

          let type = "";
          switch (alarm.type) {
            case "E01":
              type = "ÏÇ¨Î£å";
              break;
            case "E02":
              type = "Í∞ÑÏãù";
              break;
            case "E03":
              type = "ÏòÅÏñëÏ†ú";
              break;
            case "E04":
              type = "ÏïΩ";
              break;
            default:
              type = "";
          }

          let cycleDays = 0;
          switch (alarm.alarmCycle) {
            case "A01":
              cycleDays = 1;
              break;
            case "A02":
              cycleDays = 2;
              break;
            case "A03":
              cycleDays = 3;
              break;
            case "A04":
              cycleDays = 5;
              break;
            case "A05":
              cycleDays = 7;
              break;
            case "A06":
              cycleDays = 14;
              break;
            default:
              cycleDays = 0;
          }

          let isactive;
          switch (alarm.activeYn) {
            case "Y":
              isactive = true;
              break;
            case "N":
              isactive = false;
              break;
          }

          // ÏãúÍ∞Ñ Î¨∏ÏûêÏó¥ ÏÉùÏÑ±
          const formatted = `${year}-${month}-${day} ${hour}:${min} (Ï£ºÍ∏∞: ${cycleDays}Ïùº)`;
          newFormattedTimes.push(formatted);

          return {
            alamrCycleCode: alarm.alarmCycle,
            daysDate,
            daysTime,
            types: "SET_ALARM",
            alarmId,
            petId,
            alarmName,
            year,
            month,
            day,
            hour,
            min,
            alarmCycle: cycleDays,
            type: type,
            enabled: isactive, // Ï¥àÍ∏∞ÏóêÎäî ÏºúÏ†∏ÏûàÎã§Í≥† Í∞ÄÏ†ï
            // message: "ÏïåÎûåÏïÑÏù¥Îîî : " + alarmId + " // " + cycleDays + "Î∂ÑÏ£ºÍ∏∞",
            message: petInfo.data.animalName+"ÏóêÍ≤å "+type+"ÏùÑ Ï§Ñ ÏãúÍ∞ÑÏûÖÎãàÎã§.",
          };
        });

        setAlarmList(alarms);

        // AndroidÎ°ú ÎÑòÍ∏∏ ÎïåÎäî enabled=trueÏù∏ Í≤ÉÎßå ÌïÑÌÑ∞Ìï¥ÏÑú JSON Î≥ÄÌôò
        const activeData = alarms.filter((alarm) => alarm.enabled === true);
        const alarmData = JSON.stringify(activeData);

        try {
          if (window.Android && window.Android.AlarmSet) {
            window.Android.AlarmSet(alarmData);
          } else {
            console.warn("Android Ïù∏ÌÑ∞ÌéòÏù¥Ïä§Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
          }
        } catch (e) {
          // console.error("Android Alarm Ìò∏Ï∂ú Ï§ë Ïò§Î•ò:", e);
          showAlert ("Android Alarm Ìò∏Ï∂ú Ï§ë Ïò§Î•ò:");
        }
      } else {
        // showAlert("Îç∞Ïù¥ÌÑ∞Ï°∞ÌöåÏã§Ìå®1");
        console.log("ÏùëÎãµ Íµ¨Ï°∞ Ïù¥ÏÉÅ:", response.data);
      }
    } catch (error) {
      // showAlert("Îç∞Ïù¥ÌÑ∞Ï°∞ÌöåÏã§Ìå®2");
      console.error(error);
    }
  };

  const tabIndexToPath = [
    `/pet/petFormHospital.do?animalId=${animalId}`,
    `/pet/petFormEatAlarm.do?animalId=${animalId}`,
    `/pet/petFormTrainingAndAction.do?animalId=${animalId}`,
  ];

  console.log("ÎèôÎ¨º ID ÌôïÏù∏:", animalId); // ‚Üí 8Ïù¥Ïñ¥Ïïº Ï†ïÏÉÅ
  useEffect(() => {
    console.log("petInfo : ", petInfo);
    if (petInfo?.data) {
      const fetchedPet = petInfo.data;
      setAnimalName(fetchedPet.animalName || "");

      setAnimalAdoptionDate(
        fetchedPet.animalAdoptionDate
          ? dayjs(fetchedPet.animalAdoptionDate)
          : null
      );

      // ÏÑúÎ≤ÑÏóêÏÑú Î∞õÏïÑÏò® Ïù¥ÎØ∏ÏßÄ URL Ï†ÄÏû•
      console.log("fileUrl", fileUrl);
      if (fetchedPet.fileUrl) {
        setFileUrl(fetchedPet.fileUrl); // ‚úÖ Ïù¥Í±∞ Ï∂îÍ∞Ä
        console.log("fileUrl", fetchedPet.fileUrl);
      } else {
        setExistingImageUrl("");
      }
    }
  }, [petInfo]);

  const handleTabChange = (event, newValue) => {
    setSelectedTab(newValue);
    navigate(tabIndexToPath[newValue]);
  };

  // ÌéòÏù¥ÏßÄÍ∞Ä Î∞îÎÄåÎ©¥ selectedTabÎèÑ Î∞îÎÄåÎèÑÎ°ù ÏÑ§Ï†ï
  useEffect(() => {
    const currentPath = location.pathname;
    if (pathToTabIndex.hasOwnProperty(currentPath)) {
      setSelectedTab(pathToTabIndex[currentPath]);
    }
  }, [location.pathname]);
  // Í∞Å Í≤ΩÎ°úÏóê ÎåÄÏùëÌïòÎäî ÌÉ≠ Ïù∏Îç±Ïä§ ÏÑ§Ï†ï

  //ÏàòÏ†ïÏ∞ΩÏúºÎ°ú Î≥¥ÎÇ¥Í∏∞
  const handleSubmit = async (e) => {
    e.preventDefault();
  };

  const alarmCreate = async () => {
    console.log("alarmCreate Ïã§Ìñâ");
    console.log("alarmTime : " + alarmTime + "\n" + "alarmDate : " + alarmDate);
    const data = {
      petId: animalId, // << Î≥ÄÏàòÍ∞í ÎÑ£ÏúºÎ©¥Îê®
      alarmName: alarmName,
      alarmCycle: alarmCycle,
      alarmTime: alarmTime.format("HH:mm"),
      startDate: alarmDate.format("YY/MM/DD"),
      type: eatType,
      category: "ANI", // ÏãùÎ¨ºÎ¨ºÏ£ºÍ∏∞Îäî PLA    ÎèôÎ¨ºÎ®πÏù¥Îäî ANI
    };
    if (CmUtil.isEmpty(alarmName)) {
      showAlert("Î®πÏù¥ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
      alarmNameRef.current?.focus();
      return;
    }
    if (CmUtil.isEmpty(alarmTime)) {
      showAlert("ÏïåÎûå ÏãúÍ∞ÅÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
      alarmTimeRef.current?.focus();
      return;
    }
    if (CmUtil.isEmpty(alarmDate)) {
      showAlert("ÏïåÎûå ÏãúÍ∞ÅÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
      alarmDateRef.current?.focus();
      return;
    }
    if (CmUtil.isEmpty(eatType)) {
      showAlert("Î®πÏù¥ Ï¢ÖÎ•òÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.");
      return;
    }

    if (CmUtil.isEmpty(alarmCycle)) {
      showAlert("Î®πÏù¥ Ï£ºÍ∏∞Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.");
      return;
    }
    try {
      const response = await AlarmCreate(data).unwrap();
      console.log("ÏùëÎãµ ÎÇ¥Ïö© >>", response); // Ïó¨Í∏∞Ïóê Ï∞çÌûàÎäî Í±∏ ÌôïÏù∏Ìï¥Ïïº Ìï¥!
      setEatType(""); // Î®πÏù¥ Ï¢ÖÎ•ò Ï¥àÍ∏∞Ìôî
      setAlarmName(""); // Î®πÏù¥ Ïù¥Î¶Ñ Ï¥àÍ∏∞Ìôî
      setAlarmCycle(""); // Ï£ºÍ∏∞ Ï¥àÍ∏∞Ìôî
      setAlarmTime(dayjs().hour(9).minute(0)); // ÏãúÍ∞Ñ Ï¥àÍ∏∞Ìôî
      setAlarmDate(dayjs()); // ÎÇ†Ïßú Ï¥àÍ∏∞Ìôî

      showAlert("Îì±Î°ù ÏÑ±Í≥µ!");

      await alarmSet();
    } catch (error) {
      console.error("ÏöîÏ≤≠ Ïã§Ìå®:", error);
      showAlert("Îì±Î°ùÏã§Ìå®");
    }
  };

  const toggleAlarm = (alarmId) => {
    setAlarmList((prevList) =>
      prevList.map((alarm) => {
        if (alarm.alarmId === alarmId) {
          const newEnabled = !alarm.enabled;

          if (newEnabled) {
            // ÏïåÎûå ÏºúÍ∏∞ - Android AlarmSet Ìò∏Ï∂ú
            if (window.Android && window.Android.AlarmSet) {
              const alarmData = JSON.stringify([alarm]);
              window.Android.AlarmSet(alarmData);
            }
          } else {
            // ÏïåÎûå ÎÅÑÍ∏∞ - Android cancelAlarm Ìò∏Ï∂ú
            if (window.Android && window.Android.cancelAlarm) {
              window.Android.cancelAlarm(String(alarmId));
            }
          }

          // 2. ÏÑúÎ≤Ñ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
          alarmUpdate({
            alarmId: alarm.alarmId,
            activeYn: newEnabled ? "Y" : "N",
          })
            .unwrap()
            .then(() => {
              console.log(`ÏÑúÎ≤Ñ ÏïåÎûå ${alarmId} ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å`);
            })
            .catch((err) => {
              console.error("ÏïåÎûå ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®", err);
              showAlert("ÏïåÎûå ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®");
            });

          // 3. ÌîÑÎ°†Ìä∏ ÏÉÅÌÉú Î≥ÄÍ≤Ω
          return { ...alarm, enabled: newEnabled };
        }
        return alarm;
      })
    );
  };

  const alarmDelete = (alarmId) => {
    // const isConfirmed = window.confirm("ÏïåÎûåÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?");

    showConfirm(
      'ÏïåÎûåÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?',
      () => {
        // yes callback - ÏÇ≠Ï†ú Ïã§Ìñâ
        console.log('ÏÇ≠Ï†ú ÌôïÏù∏');
        alarmDelete2(alarmId);
      },
      () => {
        // no callback - Ï∑®ÏÜå
        console.log('ÏÇ≠Ï†ú Ï∑®ÏÜå');
      }
    );
}

const alarmDelete2 = (alarmId) => {

    // 2. ÏÑúÎ≤Ñ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    alarmDel({
      alarmId: alarmId,
      delYn: "Y",
    })
      .unwrap()
      .then(() => {
        console.log(`ÏÑúÎ≤Ñ ÏïåÎûå ${alarmId} ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å`);

        // ÏïåÎûå ÎÅÑÍ∏∞ - Android cancelAlarm Ìò∏Ï∂ú
        if (window.Android && window.Android.cancelAlarm) {
          window.Android.cancelAlarm(String(alarmId));
        }

        // ÌîÑÎ°†Ìä∏ ÏÉÅÌÉúÏóêÏÑú Ï†úÍ±∞
        setAlarmList((prevList) =>
          prevList.filter((alarm) => alarm.alarmId !== alarmId)
        );
        showAlert("ÏÇ≠Ï†ú ÏÑ±Í≥µ!");
      })
      .catch((err) => {
        console.error("ÏïåÎûå ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®", err);
        showAlert("ÏïåÎûå ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®");
      });
  };

  return (
    <>
      <LocalizationProvider dateAdapter={AdapterDayjs}>
        <Box
          sx={{
            padding: "16px",
            backgroundColor: "#ffffff",
            minHeight: "100vh",
          }}
        >
          {/*ÏãùÎ¨º Ï†ïÎ≥¥ ÏàòÏ†ï Î≤ÑÌäº*/}
          <Button
            sx={{
              marginTop: "10",
              marginLeft: 40,
              backgroundColor: "#889F7F",
              width: 40,
              height: 30,
              minWidth: "unset",
              padding: 0,
              fontSize: "12px",
              borderRadius: "55%",
              color: "#fff",
            }}
            onClick={() => {
              navigate(`/pet/petFormUpdate.do?animalId=${animalId}`);
            }}
          >
            ÏàòÏ†ï
          </Button>

          <Box
            sx={{
              display: "flex",
              gap: 3,
            }}
          >
            <Box
              sx={{
                width: "60%",
              }}
            >
              <Box
                sx={{
                  display: "flex",
                  justifyContent: "space-between",
                  mb: 1,
                }}
              >
                <Typography className="plant-label">ÎèôÎ¨º Ïù¥Î¶Ñ</Typography>
                <Box
                  sx={{
                    backgroundColor: "#f0f0f0",
                    borderRadius: "5px",
                    padding: "4px 12px",
                    display: "inline-block",
                    width: 100,
                  }}
                >
                  <Typography sx={{ fontSize: "0.8rem", textAlign: "center" }}>
                    {/* Î∞∞Ïó¥ÏïàÏóê Îç∞Ïù¥ÌÑ∞ ÏûàÏùå */}
                    {petInfo?.data ? petInfo.data.animalName : "Ï†ïÎ≥¥ ÏóÜÏùå"}
                  </Typography>
                </Box>
              </Box>

              <Box
                sx={{
                  display: "flex",
                  justifyContent: "space-between",
                  mb: 1,
                }}
              >
                <Typography className="plant-label">ÏûÖÏñëÏùº ÎÇ†Ïßú</Typography>
                <Box
                  sx={{
                    backgroundColor: "#f0f0f0",
                    borderRadius: "5px",
                    padding: "4px 12px",
                    display: "inline-block",
                    width: 100,
                  }}
                >
                  <Typography sx={{ fontSize: "0.8rem", textAlign: "center" }}>
                    {/* Î∞∞Ïó¥ÏïàÏóê Îç∞Ïù¥ÌÑ∞ ÏûàÏùå */}
                    {petInfo?.data
                      ? petInfo.data.animalAdoptionDate
                      : "Ï†ïÎ≥¥ ÏóÜÏùå"}
                  </Typography>
                </Box>
              </Box>

              <Button
                sx={{
                  color: "white",
                  top: 2,
                  backgroundColor: "#88AE97",
                  borderRadius: "8px",
                  width: "100%",
                  height: 40,
                  fontSize: 13,
                  fontWeight: "bold",
                }}
                onClick={() => navigate(`/pet/walk.do?animalId=${animalId}`)}
              >
                ÏÇ∞Ï±ÖÌïòÍ∏∞
              </Button>
            </Box>

            <Avatar
              sx={{
                width: "110px",
                height: "110px",
                border: "1px solid #e0e0e0",
              }}
              src={
                petInfo?.data?.fileUrl
                  ? "http://192.168.0.30:8081" + petInfo?.data?.fileUrl
                  : DefaultImage
              }
            />
          </Box>

          <Box className="tab-menu-container">
            <Tabs
              value={selectedTab}
              onChange={handleTabChange}
              className="plant-care-tabs"
              TabIndicatorProps={{ style: { backgroundColor: "black" } }}
            >
              <Tab label="Î≥ëÏõêÏßÑÎ£å" />
              <Tab label="Î®πÏù¥ÏïåÎ¶º" />
              <Tab label="ÌõàÎ†®/ÌñâÎèô" />
            </Tabs>
          </Box>

          <Box className="tab-content-display">
            <RepottingContent
              setEatType={setEatType}
              eatType={eatType}
              alarmName={alarmName}
              setAlarmName={setAlarmName}
              setAlarmCycle={setAlarmCycle}
              alarmCycle={alarmCycle}
              alarmTime={alarmTime}
              setAlarmTime={setAlarmTime}
              alarmDate={alarmDate}
              setAlarmDate={setAlarmDate}
              alarmCreate={alarmCreate}
              alarmList={alarmList}
              toggleAlarm={toggleAlarm}
              alarmDelete={alarmDelete}
            />
          </Box>
        </Box>
      </LocalizationProvider>
    </>
  );
};
export default Pet_Form_Eat_Alarm;
